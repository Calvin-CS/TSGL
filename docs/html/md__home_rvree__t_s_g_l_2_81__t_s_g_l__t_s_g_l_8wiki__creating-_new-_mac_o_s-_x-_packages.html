<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TSGL: Creating-New-MacOS-X-Packages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TSGL
   </div>
   <div id="projectbrief">A thread-safe graphics library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating-New-MacOS-X-Packages </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><em><b>WORK IN PROGRESS!!!"</b></em></p>
<hr  />
 <h2><a class="anchor" id="autotoc_md39"></a>
| CREATING A NEW MAC OS X INSTALLER PACKAGE (Last updated: 08/11/16) |</h2>
<p>Creating a new <code>.pkg</code> Installer for Mac OS X isn't as difficult as creating an RPM or Debian package.</p>
<p>You do have to be on a Mac, however.</p>
<p>If you cannot procure a Mac with OS X 10.5 or greater (or a VM with OS X 10.5 or greater on it, <em>though this has not been tested</em>), <em><b>please stop reading and go get a Mac</b></em>.</p>
<p>Otherwise, please continue.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md41"></a>
| Packages |</h2>
<p>When we first started to create the Mac OS X Installer package, we used a tool called <code>Packages</code>.</p>
<p>This made the process of creating a Mac OS X binary installer much easier and less tedious.</p>
<p>You have to download it from this <a href="http://s.sudre.free.fr/Software/Packages/about.html">link</a>.</p>
<p>The download will be a <code>.dmg</code> file. Move it to your <code>Desktop</code>.</p>
<p>Now, mount it. (Double-click on it). You should see a Volume appear on your <code>Desktop</code> with the name, <code>Packages #.#.#</code>. Double-click on it.</p>
<p>Now, double-click on the <code>Install Packages.pkg</code> file.</p>
<p>Follow the installation process, and you should have the <code>Packages</code> tool installed.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md43"></a>
| Creating the TSGL Installer |</h2>
<p>After installing <code>Packages</code>, open up the application.</p>
<p>A screen should pop-up with the title, <code>New Project</code>.</p>
<p>This is where you choose what project you'd like to make.</p>
<p>We used the <code>Distribution</code> template, so go ahead and click on that option.</p>
<p>Click <code>Next</code>.</p>
<p>The project name will be <code>InstallTSGL</code>, and the project directory will be <code>~/Desktop</code>.</p>
<p>A screen should appear showing you the project details.</p>
<p>In here, you can edit the settings for the project, how the Installer looks, and more. <br  />
</p>
<p>On the left, you'll see a section named <code>PACKAGES</code>.</p>
<p>At the moment, there's only one package in it: <code>InstallTSGL</code>.</p>
<p>We're going to rename it to just <code>TSGL</code>.</p>
<p>Double-click on it, and when the text appears highlighted, type <code>TSGL</code> and hit <code>ENTER</code>.</p>
<p>Now, take a look at the <code>Settings</code> page.</p>
<p>This contains the settings that you can edit for this package.</p>
<p>If you take a look at the text box next to the <code>Identifier:</code> label, you can see that the Identifier for the package still has <code>InstallTSGL</code> at the end.</p>
<p>We're going to change the <code>InstallTSGL</code> part to say <code>TSGL</code>.</p>
<p>Click on the text box next to the <code>Identifier:</code> label, and delete the <code>InstallTSGL</code> part. Replace it with <code>TSGL</code> and hit <code>ENTER</code>.</p>
<p>We can now leave the <code>Settings</code> page as it is.</p>
<p>On the left, click on <code>Project</code>.</p>
<p>You'll be taken back to the <code>Settings</code> page for the Installer.</p>
<p>Leave the <code>Settings</code> page as is, and click on the <code>Presentation</code> tab.</p>
<p>In here, you'll be able to customize the text for the <code>Introduction</code>, <code>Read Me</code>, and <code>License</code> screens.</p>
<p>To do so, we must first create the text files that will hold the customized screen text.</p>
<p>Create three new text files: <code>intro.txt</code>, <code>README.txt</code>, and <code>license.txt</code>.</p>
<p>We'll edit <code>intro.txt</code> first.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md45"></a>
| &lt;tt&gt;intro.txt&lt;/tt&gt; |</h2>
<p>This is the first thing that a user will see when they double-click on the Installer package.</p>
<p>Here's the introduction that we used:</p>
<div class="fragment"><div class="line">Hello! Thank you for choosing to install TSGL on your Mac!</div>
<div class="line"> </div>
<div class="line">To start, please click &quot;Continue&quot;.</div>
</div><!-- fragment --><p>Copy and paste this into your <code>intro.txt</code> file and make any changes.</p>
<p>Save and close it when you are satisfied.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md47"></a>
| &lt;tt&gt;README.txt&lt;/tt&gt; |</h2>
<p>This is the next thing that a user will see when they continue with the installation process.</p>
<p>Essentially, we specified what dependencies would be installed and with which package manager.</p>
<div class="fragment"><div class="line">The following dependencies will be installed on your Mac:</div>
<div class="line"> </div>
<div class="line">    - X11 libs</div>
<div class="line">    - Homebrew</div>
<div class="line">    - Freetype (through Homebrew)</div>
<div class="line">    - glfw3 (through Homebrew)</div>
<div class="line">    - glew (through Homebrew)</div>
<div class="line">    - doxygen (through Homebrew)</div>
<div class="line">    - gcc5 (through Homebrew)</div>
<div class="line"> </div>
<div class="line">By clicking &quot;Continue&quot;, you agree to having these dependencies installed. </div>
</div><!-- fragment --><p>Copy the above text and paste it into your <code>README.txt</code> file.</p>
<p>Make any changes as you see fit, then save and close the file.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md49"></a>
| &lt;tt&gt;license.txt&lt;/tt&gt; |</h2>
<p>This is the last thing a user will see before selecting a destination, choosing installation type, and installing TSGL on their Mac.</p>
<p>We took the opportunity to use the license associated with TSGL (GPLv3).</p>
<p>This file is actually inside of the TSGL source code folder.</p>
<p>Simply open up the TSGL source code folder (the clone or downloaded zip file), open up <code>license</code>, and copy the text inside of it. Paste that text inside of <code>license.txt</code>.</p>
<p>Save and close the file.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md51"></a>
| Almost there |</h2>
<p>Now that we have those three text files made, it's time to integrate them into the Installer.</p>
<p>Back in <code>Packages</code>, make sure that you are in the <code>Project</code> details (click on <code>Project</code> on the left side of the window), and on the <code>Presentation</code> page (click on the <code>Presentation</code> tab).</p>
<p>In the drop down box on the right, make sure that it says <code>Introduction</code>.</p>
<p>Then, click the big plus (<code>+</code>) button underneath the <code>Custom Introduction</code> table.</p>
<p>One of the table slots inside of the <code>Custom Introduction</code> table should be filled in and highlighted.</p>
<p>Click on the section that has the <code>-</code> in it, and click <code>Choose</code> from the drop down menu.</p>
<p>Double-click on the <code>intro.txt</code> file that we made earlier.</p>
<p>Now the text inside of the <code>Introduction</code> Installer page should change to the text inside of <code>intro.txt</code>.</p>
<p>Do the same thing for the <code>README.txt</code> and <code>license.txt</code> files.</p>
<p>Once you have done that, you are almost ready to create the <code>.pkg</code> Installer!</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md53"></a>
| Installer plugins |</h2>
<p>Our Installer can have two shell scripts which are executed before and after TSGL is installed.</p>
<p>The <code>preinstall</code> and <code>postinstall</code> scripts, respectively.</p>
<p>We will go into more detail later on these scripts, but for now just know that they are needed for our Installer.</p>
<p>However, they are not the <em>ONLY</em> things that are needed.</p>
<p>As we developed the <code>.pkg</code> Installer, we focused primarily on making it self-contained.</p>
<p>We wanted a user to simply mount our <code>.dmg</code> file, double-click on the <code>.pkg</code> file, and have TSGL installed on their Mac.</p>
<p>We didn't want them to execute any programs beforehand; we wanted everything to be done by the <code>.pkg</code> Installer.</p>
<p>This proved to be most difficult with just the <code>preinstall</code> and <code>postinstall</code> scripts.</p>
<p>Which is why, another resource was needed: an Installer plugin.</p>
<p>An Installer plugin is essentially another pane that you can add to the installation process.</p>
<p>What's important about this resource?</p>
<p>You can execute commands based off of user input.</p>
<p>Even shell scripts.</p>
<p>This was <em>VERY</em> useful for us when we had to install <code>Homebrew</code> as a dependency, as well as a solution to many problems, for the reasons outlined in the next section.</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md55"></a>
| The trouble with &lt;tt&gt;preinstall&lt;/tt&gt; and &lt;tt&gt;postinstall&lt;/tt&gt; |</h2>
<p>As mentioned above, the <code>preinstall</code> and <code>postinstall</code> scripts are shell scripts which can be executed before and after TSGL is installed, respectively.</p>
<p>They are perfect for small tasks, like making symlinks or installing some dependencies.</p>
<p>However, they are run as <code>root</code>.</p>
<p>This doesn't seem like such a big deal, but consider this scenario:</p>
<p>1). The <code>preinstall</code> script is executed when the user clicks <code>Install</code> during the TSGL installation process.</p>
<p>2). The script finds that a user doesn't have <code>Homebrew</code> installed.</p>
<p>3). It attempts to install <code>Homebrew</code>.</p>
<p>4). Because the script was run as <code>root</code>, <code>Homebrew</code> refuses to install.</p>
<p>5). No dependencies are installed, and the installation process shows that TSGL was installed correctly (even though it wasn't).</p>
<p>See <a href="https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/FAQ.md">the Homebrew FAQ page</a> for more information on why using <code>sudo</code> and <code>brew</code> is a bad thing.</p>
<p>This was a recurring problem, with many workarounds attempted.</p>
<p>One of them involved creating a separate executable that the user could run <em>before</em> the <code>.pkg</code> Installer, but that would mean that the Installer would no longer be self-contained. Strike 1.</p>
<p>You can execute the scripts as normal user by changing a setting inside of the <code>.pkg</code> file <em>after</em> it's been created. That would be a workaround.</p>
<p>However, that brings another problem to the table.</p>
<p>When we have to install <code>X11</code> libs, we use the <code>curl</code> command in order to download the <code>xQuartz</code> <code>.dmg</code> file which contains a <code>.pkg</code> file so that they can be installed.</p>
<p>We then open up that file and tell the user to follow the installation process.</p>
<p>But...two Installers <em>cannot</em> be running at the same time.</p>
<p>If they are, one will wait for the other to finish before beginning.</p>
<p>This <em>always</em> happened with the installation of the <code>X11</code> libs.</p>
<p>The installation would wait until <em>after</em> the installation of TSGL was completed, then move onto installing <code>X11</code> libs. TSGL needs those libs in order to compile, and because they were not installed <em>before</em> TSGL, this would mean that TSGL would fail to compile and would <em>NOT</em> be installed correctly.</p>
<p>A workaround for this would be to use the <code>installer</code> command and use it to install the <code>.pkg</code> file via a Terminal.</p>
<p>But...the execution of the <code>installer</code> command could cause the same issue (two Installer running at the same time).</p>
<p>Even if it were to work, this workaround brings with it a new problem.</p>
<p>For some odd reason, the commands executed by the <code>preinstall</code> script are asynchronous.</p>
<p>What this means is that when one command is executed, the next command doesn't wait until the first has terminated. It executes, and the successive commands do the same.</p>
<p>This is really bad in terms of installing dependencies.</p>
<p>To give an example, consider <code>Homebrew</code> again.</p>
<p><code>Homebrew</code> needs to be installed before <code>glew</code>, <code>glfw3</code>, <code>doxygen</code>, <code>freetype</code>, and <code>gcc5</code>.</p>
<p>If a user doesn't have <code>Homebrew</code> installed, the script needs to install <code>Homebrew</code>.</p>
<p>As a consequence of the commands being executed asynchronously, the other dependencies will also be installed <em>regardless of the <code>Homebrew</code> install finishing or not</em>.</p>
<p>This would lead to another failed install. Strike 2.</p>
<p>There are other problems, but we won't go into them in detail.</p>
<p>We attempted numerous workarounds, ranging from having the <code>preinstall</code> script execute other install scripts, to using <code>sleep</code> and <code>wait</code> commands.</p>
<p>None of them provided a solid, foolproof binary Installer. Strike 3.</p>
<p>Given all of these reasons, we ultimately decided to go with Installer plugins.</p>
<p>They provided a solid, self-contained, foolproof Installer.</p>
<p>We used one to install <code>Homebrew</code>, and <code>X11</code> libs.</p>
<p>We also utilized the <code>sleep</code> command in order to avoid having multiple dependencies installed at once (e.g. <code>XCode Command Line Tools</code> and dependencies installed by <code>Homebrew</code>).</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md57"></a>
| Back to Installer plugins |</h2>
<hr  />
 <h2><a class="anchor" id="autotoc_md59"></a>
| Building the Installer |</h2>
<hr  />
 <h2><a class="anchor" id="autotoc_md61"></a>
| Wrapping it up in a .dmg file |</h2>
<p>Now that you have the <code>.pkg</code> file created, it's time to wrap it up in a <code>.dmg</code> file.</p>
<p>Open up the <code>Disk Utility</code> application (which should be located in a folder called <code>Utilities</code>).</p>
<p>This is where we'll be creating the .dmg file.</p>
<p>That concludes this page!</p>
<hr  />
 <h2><a class="anchor" id="autotoc_md63"></a>
| MISC |</h2>
<p>For more help with the Packages tool, please see this website: <a href="http://s.sudre.free.fr/Software/documentation/Packages/en/index.html">http://s.sudre.free.fr/Software/documentation/Packages/en/index.html</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 26 2021 14:23:49 for TSGL by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
